<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>主页</title>
    <style>
    </style>
    <!--<script src="https://unpkg.com/@supabase/supabase-js@2"></script>-->
    <script type="module" src="./util.js"></script>
</head>
<body>
    <!--<script type="module" >
        import  './util.js';
        //consoel.log(_supabase);
        //const { data: { user } } = await _supabase.auth.getUser();
        //if (user) {
        //    // 用户已登录
        //    console.log('登录');
        //} else {
        //    // 用户未登录
        //    window.location.href = "/login.html";
        //}
    </script>-->
    <!--<script>
        const { createClient } = supabase
        const _supabase = createClient('https://zycrlpopiqgzvwyxrvpv.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp5Y3JscG9waXFnenZ3eXhydnB2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEyNDg4NzgsImV4cCI6MjA1NjgyNDg3OH0.pALWiHHBF3Ge9tREPbITkElvj3Mrk7CHsuY2fUt9C5k')
        debugger
        console.log('Supabase Instance: ', _supabase)

        async function checklogin() {
            //debugger
            //const { data } = _supabase.auth.onAuthStateChange((event, session) => {
            //    console.log(event, session)

            //    if (event === 'INITIAL_SESSION') {
            //        // handle initial session
            //    } else if (event === 'SIGNED_IN') {
            //        // handle sign in event
            //    } else if (event === 'SIGNED_OUT') {
            //        // handle sign out event
            //    } else if (event === 'PASSWORD_RECOVERY') {
            //        // handle password recovery event
            //    } else if (event === 'TOKEN_REFRESHED') {
            //        // handle token refreshed event
            //    } else if (event === 'USER_UPDATED') {
            //        // handle user updated event
            //    }
            //})

            // call unsubscribe to remove the callback
            //data.subscription.unsubscribe()

            const { data: { user } } = await _supabase.auth.getUser();
            if (user) {
                // 用户已登录
                console.log('登录');
            } else {
                // 用户未登录
                window.location.href = "/login.html";
            }
        }

        async function sign() {
            //debugger;
            //const { data, error } = await _supabase.auth.signInWithPassword({
            //    email: 'tt',
            //    password: 'tt',
            //})

            ////window.location.href = "/login.html";
            //var ret = await _supabase
            //    .from('sys_test')
            //    .select();
            //console.log(ret);



        }
        checklogin();
        sign();
    </script>-->
    <script>
        window.onload = async function (){
            var _supabase = window._supabase;
            const { data: { user } } = await _supabase.auth.getUser();
            if (user) {
                // 用户已登录
            } else {
                // 用户未登录
                window.location.href = "/login.html";
            }
        }
    </script>
</body>
</html>
